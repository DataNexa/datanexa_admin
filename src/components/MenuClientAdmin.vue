<template>
    <div class="left__menu__datanext shadow p-fixed" style="z-index:4">
        <div class="brand_menu">
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="200px" height="50px" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"
            viewBox="0 0 200 50"
            xmlns:xlink="http://www.w3.org/1999/xlink">
                <g id="Camada_x0020_1">
                    <g id="_2186486663840">
                        <path class="fill-blue-light" d="M110.2 16.51c1.84,0 2.63,0.27 4.12,1.15 0.42,0.24 0.83,0.51 1.21,0.81 -0.2,-0.42 -0.58,-0.96 -1.03,-1.18l0.35 -0.69 3.45 0 0 5.91 0 5.13 0 5.76 -3.7 0 -0.1 -0.51c0.48,-0.29 0.79,-0.51 0.94,-1.15 -0.3,0.24 -0.61,0.45 -0.94,0.64 -1.48,0.79 -2.45,1.09 -4.3,1.11 -4.68,0.07 -8.49,-3.8 -8.49,-8.49 0,-4.69 3.81,-8.49 8.49,-8.49zm-28.8 0c1.84,0 2.63,0.27 4.12,1.15 0.43,0.24 0.83,0.51 1.21,0.81 -0.19,-0.42 -0.58,-0.96 -1.03,-1.18l0.35 -0.69 3.45 0 0 5.91 0 5.13 0 5.76 -3.7 0 -0.1 -0.51c0.48,-0.29 0.79,-0.51 0.94,-1.15 -0.29,0.24 -0.61,0.45 -0.94,0.64 -1.47,0.79 -2.45,1.09 -4.3,1.11 -4.68,0.07 -8.49,-3.8 -8.49,-8.49 0,-4.69 3.81,-8.49 8.49,-8.49zm-3.96 8.49c0,2.19 1.78,3.96 3.96,3.96 2.27,0 4.37,-1.93 4.37,-4.24 0,-2.24 -1.82,-4.06 -4.06,-4.06 -2.28,0 -4.27,2.07 -4.27,4.34zm15.52 -8.4l5.28 0 0 1.7 0 0.5 0.43 -0.01 3.73 -0.02 -1.91 3.32 -1.75 0 -0.5 -1.02 0 1.49 0 0.41 0 10.42 -5.28 0 0 -10.63 0 -0.34 0 -1.28 -0.5 0.92 -1.2 -0.01 0 -3.21 1.7 -0.01 0 -0.53 0 -1.7zm-21.32 8.44c0,-4.64 -3.44,-8.44 -7.65,-8.44 -3.2,0 -6.41,0 -9.62,0l0 16.9 0.28 -0.02 9.34 0c4.21,0 7.65,-3.79 7.65,-8.44zm-12.02 -4.68l0.73 1.45 3.12 0c1.61,0 2.93,1.45 2.93,3.23 0,1.78 -1.32,3.23 -2.93,3.23l-3.06 0.02 -0.89 1.2 0.03 -1.95 0.07 -7.18zm46.62 4.64c0,2.19 1.78,3.96 3.96,3.96 2.27,0 4.37,-1.93 4.37,-4.24 0,-2.24 -1.82,-4.06 -4.06,-4.06 -2.28,0 -4.27,2.07 -4.27,4.34z"/>
                        <path class="fill-white" d="M176.83 16.63c1.84,0 2.62,0.28 4.12,1.16 0.42,0.23 0.83,0.51 1.21,0.81 -0.2,-0.43 -0.58,-0.96 -1.03,-1.18l0.35 -0.69 3.44 0 0 5.91 0 5.13 0 5.75 -3.69 0 -0.1 -0.5c0.48,-0.29 0.78,-0.51 0.94,-1.15 -0.3,0.23 -0.61,0.45 -0.94,0.64 -1.48,0.78 -2.45,1.08 -4.3,1.11 -4.69,0.06 -8.49,-3.8 -8.49,-8.49 0,-4.69 3.8,-8.5 8.49,-8.5zm-48.19 -0.24c4.2,0 7.64,3.43 7.64,7.64l0 9.34 -4.71 0 0 -8.82c0,-1.61 -1.32,-2.92 -2.93,-2.92 -1.61,0 -2.92,1.31 -2.92,2.92l0 8.82 -4.72 0 0 -9.34 0 -7.52 3 0 0.32 0.7c-0.71,0.46 -1.31,1.08 -1.31,1.67l0 0c1.4,-1.53 3.41,-2.49 5.63,-2.49zm40.84 17.12l-4.5 0.05 -3.38 -4.53 -0.04 -1.84 -5.09 6.31 -5.92 0.03 7.71 -9.26 -6.36 -7.63 4.34 0.01 5.32 6.75 -0.55 -2.4 3.41 -4.35 5.9 -0.01 -7.27 8.95 6.43 7.92zm-23.81 -17.12c3.09,0 5.79,1.63 7.31,4.08l-0.09 0.08 -3.37 3.38 -4.19 4.19 -1.96 0.02c0.51,0.41 0.89,0.6 1.25,0.68l0 0c0.14,0.04 0.28,0.07 0.43,0.09 0.2,0.04 0.4,0.05 0.62,0.05 0.9,0 1.74,-0.3 2.41,-0.81l1.36 1.39 1.87 1.9c-1.51,1.32 -3.48,2.12 -5.64,2.12 -4.75,0 -8.59,-3.85 -8.59,-8.59 0,-4.74 3.84,-8.58 8.59,-8.58zm2.97 5.15c-1.23,-0.46 -2.31,-0.72 -3.63,-0.5 -1.89,0.31 -3.34,1.95 -3.34,3.93 0,0.48 0.09,0.96 0.26,1.41l4.7 -4.61 2.01 -0.23zm24.23 3.59c0,2.18 1.77,3.96 3.96,3.96 2.27,0 4.36,-1.94 4.36,-4.25 0,-2.24 -1.81,-4.05 -4.06,-4.05 -2.28,0 -4.26,2.07 -4.26,4.34z"/>
                    </g>
                    <polygon class="fill-white" points="39.31,38.31 32.18,38.38 26.85,31.23 26.78,28.31 18.73,38.29 9.37,38.34 21.55,23.7 11.5,11.63 18.36,11.63 26.78,22.32 25.91,18.52 31.31,11.63 40.63,11.62 29.14,25.78 "/>
                </g>
            </svg>
        </div>
        <router-link to="/">
            <div :class="`left_item action_menu ${atualPage == 'home' || atualPage == '' ? 'selected' : ''}`" label="Home">
                <div class="item_icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="40px" height="50px" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"
                        viewBox="0 0 40 50"
                        xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g >
                            <path class="fill" d="M18.48 27.67l0.01 -0.1 3.02 0 0.01 0.1 0 4.92 -3.04 0 0 -4.92zm-1.48 4.91c-0.16,0.03 -1.39,0.02 -1.58,0 -0.48,-0.07 -0.81,-0.33 -1.02,-0.6 -0.29,-0.37 -0.31,-0.75 -0.31,-1.3l0 -8.1c0.42,-0.33 1.02,-0.86 1.47,-1.22 0.51,-0.42 0.98,-0.84 1.49,-1.25l2.98 -2.46 2.19 1.84c0.13,0.11 0.25,0.21 0.37,0.32l0.72 0.61c0.71,0.58 1.57,1.33 2.24,1.86 0.11,0.09 0.26,0.21 0.36,0.31l0 8.06c0,0.55 -0.01,0.94 -0.29,1.31 -0.2,0.27 -0.54,0.54 -1.01,0.61 -0.28,0.04 -1.3,0.04 -1.61,0.01 0,-0.52 0.03,-5.64 -0.01,-5.89 -0.14,-0.8 -1.08,-0.6 -1.77,-0.6l-3.58 0c-0.84,0.1 -0.64,1.13 -0.64,1.75 0,1.58 0,3.15 0,4.74zm2.99 -16.65c-0.22,0 -0.39,0.11 -0.5,0.2l-3.45 2.89c-0.25,0.21 -0.52,0.42 -0.76,0.64 -0.25,0.21 -0.5,0.42 -0.76,0.63l-2.29 1.92c-0.47,0.42 -1.03,0.85 -1.53,1.28 -0.22,0.2 -0.57,0.39 -0.5,0.89 0.06,0.36 0.37,0.64 0.78,0.62 0.49,-0.02 1.18,-0.9 1.63,-1.15 0,1.28 0,2.56 0,3.85 0,0.69 -0.04,3.35 0.03,3.83 0.16,1.07 0.87,1.85 1.62,2.22 0.52,0.26 0.99,0.32 1.63,0.32l8.25 0c0.67,0 1.08,-0.06 1.6,-0.32 0.76,-0.38 1.46,-1.14 1.62,-2.23 0.09,-0.62 0.02,-6.73 0.04,-7.68l1.16 0.97c0.55,0.44 1.25,0.07 1.25,-0.55 0,-0.4 -0.26,-0.56 -0.45,-0.71 -0.12,-0.11 -0.2,-0.18 -0.31,-0.27 -0.57,-0.43 -1.56,-1.36 -2.15,-1.8 -0.12,-0.09 -0.2,-0.17 -0.31,-0.26l-1.54 -1.29c-0.64,-0.5 -1.81,-1.5 -2.46,-2.07l-1.86 -1.55c-0.2,-0.17 -0.4,-0.38 -0.74,-0.38z"/>
                        </g>
                    </svg>
                </div>
                <div class="item_description py-3">
                    Home
                </div>
            </div>
        </router-link>
        <router-link v-if="pagesPermissions.includes('contatos')" to="/contatos">
            <div :class="`left_item action_menu ${atualPage == 'contatos' ? 'selected' : ''}`"  label="Contatos">
                <div class="item_icon">
                    <Icon :icon="'IconContatos'" :scale="0.65" fill="primary"/>
                </div>
                <div class="item_description py-3">
                    Contatos
                </div>
            </div>
        </router-link>
        <router-link v-if="pagesPermissions.includes('campanhas')" to="/campanhas">
            <div :class="`left_item action_menu ${atualPage == 'campanhas' ? 'selected' : ''}`"  label="Campanhas">
                <div class="item_icon">
                    <Icon :icon="'IconCampanha'" :scale="0.65" fill="primary"/>
                </div>
                <div class="item_description py-3">
                    Campanhas
                </div>
            </div>
        </router-link>
        <router-link v-if="pagesPermissions.includes('pesquisas')" to="/pesquisas">
            <div :class="`left_item action_menu ${atualPage == 'pesquisas' ? 'selected' : ''}`"  label="Pesquisas">
                <div class="item_icon">
                    <Icon :icon="'IconPesquisas'" :scale="0.65" fill="primary"/>
                </div>
                <div class="item_description py-3">
                    Pesquisas
                </div>
            </div>
        </router-link>
        <router-link v-if="pagesPermissions.includes('monitoramento')" to="/monitoramento">
            <div :class="`left_item action_menu ${atualPage == 'monitoramento' ? 'selected' : ''}`"  label="Monitoramento">
                <div class="item_icon">
                    <Icon :icon="'IconMonitoramento'" :scale="0.65" :fill="'primary'"/>
                </div>
                <div class="item_description py-3">
                    Monitoramento
                </div>
            </div>
        </router-link>
        <router-link v-if="pagesPermissions.includes('user')" to="/user">
            <div :class="`left_item action_menu ${atualPage == 'user' ? 'selected' : ''}`"  label="User">
                <div class="item_icon">
                    <Icon icon="IconUsuarios" :scale="0.65" fill="primary"/>
                </div>
                <div class="item_description py-3">
                    Usu√°rios
                </div>
            </div>
        </router-link>
     </div>
</template>

<script lang="ts">
import { App } from '@/model/Entidades/App';
import { defineComponent } from 'vue';
import Icon from './Icon.vue';

export default defineComponent({

    components:{ Icon },

    created() {

        this.atualPage = this.$route.path.substring(1,this.$route.path.length).split('/')[0] 

        const user = App.getUser()
        const userj = App.getUserJson() as any

        if(userj.tipo_usuario == 'ADMIN_CLIENT' || userj.tipo_usuario == 'ADMIN'){
            this.pagesPermissions = this.pages
        }

        for(const permision of userj.permissions){
            let pag = permision.split('@')[0].trim()
            if(this.pages.includes(pag) && !this.pagesPermissions.includes(pag)){
                user?.setPagePermission(pag)
                this.pagesPermissions.push(pag)
            }
        }
        
        this.$router.beforeEach((to, from, next) => {
            this.olderPage = this.atualPage
            this.atualPage = to.path.substring(1,to.path.length).split('/')[0]
            next();
        });
    },

    data() {
        return {
            olderPage:'',
            atualPage:'home',
            pages:['home', 'contatos', 'campanhas', 'pesquisas', 'monitoramento', 'user'],
            pagesPermissions:['home', '']
        }
    },

})

</script>